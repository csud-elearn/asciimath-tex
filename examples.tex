\documentclass{article}
\usepackage{asciimth}
\usepackage{amsmath}

\def\startTrace{\message{Starting trace...@}%
    \tracingmacros=2\tracingassigns=2\tracingcommands=2%
}
\def\endTrace{\message{Ending trace...@}\tracingmacros=0\tracingassigns=0\tracingcommands=0}

% OK, note this doesn't really test spaces well.
\begingroup
\catcode32=13%
\gdef\changeSpaces{%
\catcode32=13%
\let =\ %
}
\endgroup
\def\changeSpacesBack{\catcode32=10}

\def\testRow{\hline\changeSpaces\testRowA}
\def\testRowA#1{%
    \changeSpacesBack
    \exampleRow{\replaceSuperSubScript#1\end}{`#1`}%
}
    
% TODO: better formatting of math (displaymath, more vert margings)
\def\mathcell#1{#1}
%\def\mathcell#1{\begin{minipage}{3cm}$$#1$$\end{minipage}}
%\def\mathcell#1{$\displaystyle #1$}
\def\exampleRow#1#2{%
    {\tt\char18#1\char18}%
    %& #2\tabularnewline%
    & \mathcell{#2}\tabularnewline
}

% We can't just set the catcodes of ^ and _ because we want them as letters
% in the \tt but as super/subscripts in the `...`.
\def\replaceSuperSubScript{\futurelet\nextTok\replaceSuperSubScriptA}
\def\replaceSuperSubScriptA#1{%
    \ifx#1\end\let\next=\relax
    \else\ifx#1^\def\next{\char94\replaceSuperSubScript}%
    \else\ifx#1_\def\next{\char95\replaceSuperSubScript}%
    \else\def\next{#1\replaceSuperSubScript}%
    \fi\fi\fi
    \next
}

\def\rawExampleRow{\hline\changeSpaces\readFirstPart}
\def\readFirstPart#1{\changeSpacesBack\exampleRow{#1}}

\parskip=10pt

\newenvironment{examples}[1]
    {\renewcommand{\arraystretch}{1.5}
    \renewcommand{\tabcolsep}{0.2cm}
    \begin{tabular}{|p{6cm}|p{3cm}|}
        \multicolumn{2}{c}{\textbf{#1}}\\}
    {\hline\end{tabular}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

This document displays a list of examples of equations typeset with the
{\tt asciimth} package.  It serves both as documentation and as a test of all of
the features in the package.

\startTrace
\begin{examples}{Simple commands}
\testRow{9+alpha}
\testRow{ (9)}
\testRow{9+(4-(alpha))}
\testRow{gamma>2 implies gamma*gamma>4}
\testRow{x ge 0 implies x x ge 0}
\testRow{t}
\testRow{1-a}
\testRow{1 234}
\testRow{[2,3)}
\rawExampleRow{}{``}
\rawExampleRow{ }{` `}
\end{examples}

\begin{examples}{Fractions}
\testRow{9/2}
\testRow{(1//2]/(7//4)}
\testRow{(9)/(7)}
\testRow{ 2/3 + ((alpha+2)/2 * 5)/7}
\testRow{2/3/3}
\testRow{-5/zeta}
\testRow{z/((q*(2/beta to gamma)))}
\testRow{([2/3])/7}
\testRow{Phi = 1+1/(1+1/(1+cdots))}
\end{examples}

\begin{examples}{Exponents and subscripts}
\testRow{5^14}
\testRow{5_14}
\testRow{(9^-74)}
\testRow{ 125^-74}
\testRow{1/125^74}
\testRow{(1/125)^74}
\testRow{alpha^(2+3)/5}
\testRow{x^n y_1^-t alpha^-(beta-z)}
\testRow{(q r s)_(123)^-[456/z]}
\testRow{a_1^2}
\testRow{(a+b)_(k_1)^(x+2)}
\testRow{sum_(n=1)^infty 1/n^2}
\testRow{int_pi^infty 1/(sin x)^2 d x}
\end{examples}

\begin{examples}{Square roots}
\testRow{sqrt 2}
\testRow{sqrt(2+4/5)}
\testRow{2/sqrt(3alpha)}
\testRow{sqrt sqrt 3}
\testRow{(2+3)/sqrt sqrt sqrt 3}
\end{examples}

\end{document}
